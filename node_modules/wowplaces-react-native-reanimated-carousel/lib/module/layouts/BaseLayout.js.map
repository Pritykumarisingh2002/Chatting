{"version":3,"names":["React","Animated","runOnJS","useAnimatedReaction","useAnimatedStyle","useDerivedValue","useCheckMounted","useOffsetX","LazyView","CTX","BaseLayout","props","mounted","handlerOffset","index","children","visibleRanges","animationStyle","context","useContext","loop","dataLength","width","height","vertical","customConfig","mode","modeConfig","size","shouldUpdate","setShouldUpdate","useState","offsetXConfig","snapDirection","showLength","type","viewCount","x","animationValue","value","animatedStyle","updateView","useCallback","negativeRange","positiveRange","current","createElement","View","style","position","testID"],"sources":["BaseLayout.tsx"],"sourcesContent":["import React from \"react\";\nimport type { ViewStyle } from \"react-native\";\nimport type { AnimatedStyleProp } from \"react-native-reanimated\";\nimport Animated, {\n  runOnJS,\n  useAnimatedReaction,\n  useAnimatedStyle,\n  useDerivedValue,\n} from \"react-native-reanimated\";\n\nimport type { ILayoutConfig } from \"./stack\";\n\nimport { useCheckMounted } from \"../hooks/useCheckMounted\";\nimport type { IOpts } from \"../hooks/useOffsetX\";\nimport { useOffsetX } from \"../hooks/useOffsetX\";\nimport type { IVisibleRanges } from \"../hooks/useVisibleRanges\";\nimport { LazyView } from \"../LazyView\";\nimport { CTX } from \"../store\";\n\nexport type TAnimationStyle = (value: number) => AnimatedStyleProp<ViewStyle>;\n\nexport const BaseLayout: React.FC<{\n  index: number\n  handlerOffset: Animated.SharedValue<number>\n  visibleRanges: IVisibleRanges\n  animationStyle: TAnimationStyle\n  children: (ctx: {\n    animationValue: Animated.SharedValue<number>\n  }) => React.ReactElement\n}> = (props) => {\n  const mounted = useCheckMounted();\n  const { handlerOffset, index, children, visibleRanges, animationStyle }\n  = props;\n\n  const context = React.useContext(CTX);\n  const {\n    props: {\n      loop,\n      dataLength,\n      width,\n      height,\n      vertical,\n      customConfig,\n      mode,\n      modeConfig,\n    },\n  } = context;\n  const size = vertical ? height : width;\n  const [shouldUpdate, setShouldUpdate] = React.useState(false);\n  let offsetXConfig: IOpts = {\n    handlerOffset,\n    index,\n    size,\n    dataLength,\n    loop,\n    ...(typeof customConfig === \"function\" ? customConfig() : {}),\n  };\n\n  if (mode === \"horizontal-stack\") {\n    const { snapDirection, showLength } = modeConfig as ILayoutConfig;\n\n    offsetXConfig = {\n      handlerOffset,\n      index,\n      size,\n      dataLength,\n      loop,\n      type: snapDirection === \"right\" ? \"negative\" : \"positive\",\n      viewCount: showLength,\n    };\n  }\n\n  const x = useOffsetX(offsetXConfig, visibleRanges);\n  const animationValue = useDerivedValue(() => x.value / size, [x, size]);\n  const animatedStyle = useAnimatedStyle(\n    () => animationStyle(x.value / size),\n    [animationStyle],\n  );\n\n  const updateView = React.useCallback(\n    (negativeRange: number[], positiveRange: number[]) => {\n      mounted.current\n                && setShouldUpdate(\n                  (index >= negativeRange[0] && index <= negativeRange[1])\n                        || (index >= positiveRange[0] && index <= positiveRange[1]),\n                );\n    },\n    [index, mounted],\n  );\n\n  useAnimatedReaction(\n    () => visibleRanges.value,\n    () => {\n      runOnJS(updateView)(\n        visibleRanges.value.negativeRange,\n        visibleRanges.value.positiveRange,\n      );\n    },\n    [visibleRanges.value],\n  );\n\n  return (\n    <Animated.View\n      style={[\n        {\n          width: width || \"100%\",\n          height: height || \"100%\",\n          position: \"absolute\",\n        },\n        animatedStyle,\n      ]}\n      /**\n       * We use this testID to know when the carousel item is ready to be tested in test.\n       * e.g.\n       *  The testID of first item will be changed to __CAROUSEL_ITEM_0_READY__ from __CAROUSEL_ITEM_0_NOT_READY__ when the item is ready.\n       * */\n      testID={`__CAROUSEL_ITEM_${index}_${shouldUpdate ? \"READY\" : \"NOT_READY\"}__`}\n    >\n      <LazyView shouldUpdate={shouldUpdate}>\n        {children({ animationValue })}\n      </LazyView>\n    </Animated.View>\n  );\n};\n"],"mappings":"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"}