{"version":3,"names":["_react","_interopRequireDefault","require","_reactNativeReanimated","_interopRequireWildcard","_useCheckMounted","_useOffsetX","_LazyView","_store","_this","_jsxFileName","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","_worklet_3217166169285_init_data","code","location","sourceMap","_worklet_11301275444738_init_data","_worklet_11113070436332_init_data","_worklet_15128277149381_init_data","BaseLayout","props","mounted","useCheckMounted","handlerOffset","index","children","visibleRanges","animationStyle","context","React","useContext","CTX","_context$props","loop","dataLength","width","height","vertical","customConfig","mode","modeConfig","size","_React$useState","useState","_React$useState2","_slicedToArray2","shouldUpdate","setShouldUpdate","offsetXConfig","_ref","snapDirection","showLength","type","viewCount","x","useOffsetX","animationValue","useDerivedValue","_e","global","Error","_f","value","_closure","__initData","__workletHash","__stackDetails","__version","animatedStyle","useAnimatedStyle","updateView","useCallback","negativeRange","positiveRange","current","useAnimatedReaction","runOnJS","createElement","View","style","position","testID","__self","__source","fileName","lineNumber","columnNumber","LazyView","exports"],"sources":["BaseLayout.tsx"],"sourcesContent":["import React from \"react\";\nimport type { ViewStyle } from \"react-native\";\nimport type { AnimatedStyleProp } from \"react-native-reanimated\";\nimport Animated, {\n  runOnJS,\n  useAnimatedReaction,\n  useAnimatedStyle,\n  useDerivedValue,\n} from \"react-native-reanimated\";\n\nimport type { ILayoutConfig } from \"./stack\";\n\nimport { useCheckMounted } from \"../hooks/useCheckMounted\";\nimport type { IOpts } from \"../hooks/useOffsetX\";\nimport { useOffsetX } from \"../hooks/useOffsetX\";\nimport type { IVisibleRanges } from \"../hooks/useVisibleRanges\";\nimport { LazyView } from \"../LazyView\";\nimport { CTX } from \"../store\";\n\nexport type TAnimationStyle = (value: number) => AnimatedStyleProp<ViewStyle>;\n\nexport const BaseLayout: React.FC<{\n  index: number\n  handlerOffset: Animated.SharedValue<number>\n  visibleRanges: IVisibleRanges\n  animationStyle: TAnimationStyle\n  children: (ctx: {\n    animationValue: Animated.SharedValue<number>\n  }) => React.ReactElement\n}> = (props) => {\n  const mounted = useCheckMounted();\n  const { handlerOffset, index, children, visibleRanges, animationStyle }\n  = props;\n\n  const context = React.useContext(CTX);\n  const {\n    props: {\n      loop,\n      dataLength,\n      width,\n      height,\n      vertical,\n      customConfig,\n      mode,\n      modeConfig,\n    },\n  } = context;\n  const size = vertical ? height : width;\n  const [shouldUpdate, setShouldUpdate] = React.useState(false);\n  let offsetXConfig: IOpts = {\n    handlerOffset,\n    index,\n    size,\n    dataLength,\n    loop,\n    ...(typeof customConfig === \"function\" ? customConfig() : {}),\n  };\n\n  if (mode === \"horizontal-stack\") {\n    const { snapDirection, showLength } = modeConfig as ILayoutConfig;\n\n    offsetXConfig = {\n      handlerOffset,\n      index,\n      size,\n      dataLength,\n      loop,\n      type: snapDirection === \"right\" ? \"negative\" : \"positive\",\n      viewCount: showLength,\n    };\n  }\n\n  const x = useOffsetX(offsetXConfig, visibleRanges);\n  const animationValue = useDerivedValue(() => x.value / size, [x, size]);\n  const animatedStyle = useAnimatedStyle(\n    () => animationStyle(x.value / size),\n    [animationStyle],\n  );\n\n  const updateView = React.useCallback(\n    (negativeRange: number[], positiveRange: number[]) => {\n      mounted.current\n                && setShouldUpdate(\n                  (index >= negativeRange[0] && index <= negativeRange[1])\n                        || (index >= positiveRange[0] && index <= positiveRange[1]),\n                );\n    },\n    [index, mounted],\n  );\n\n  useAnimatedReaction(\n    () => visibleRanges.value,\n    () => {\n      runOnJS(updateView)(\n        visibleRanges.value.negativeRange,\n        visibleRanges.value.positiveRange,\n      );\n    },\n    [visibleRanges.value],\n  );\n\n  return (\n    <Animated.View\n      style={[\n        {\n          width: width || \"100%\",\n          height: height || \"100%\",\n          position: \"absolute\",\n        },\n        animatedStyle,\n      ]}\n      /**\n       * We use this testID to know when the carousel item is ready to be tested in test.\n       * e.g.\n       *  The testID of first item will be changed to __CAROUSEL_ITEM_0_READY__ from __CAROUSEL_ITEM_0_NOT_READY__ when the item is ready.\n       * */\n      testID={`__CAROUSEL_ITEM_${index}_${shouldUpdate ? \"READY\" : \"NOT_READY\"}__`}\n    >\n      <LazyView shouldUpdate={shouldUpdate}>\n        {children({ animationValue })}\n      </LazyView>\n    </Animated.View>\n  );\n};\n"],"mappings":"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"}